---
description: AwithGameFrame重构经验与注意事项
globs: Assets/Scripts/AwithGameFrame/**/*.cs
---

# AwithGameFrame 重构经验与注意事项

## 重构原则
- **具体问题具体分析**: 根据模块特点选择重构方案
- **渐进式重构**: 分步骤进行，保持编译通过
- **向后兼容**: 尽量保持现有API的兼容性
- **测试验证**: 重构后确保功能正常

## 日志系统重构案例

### 问题识别
- 枚举嵌套在类内部，造成命名空间冲突
- 配置字段分散，难以统一管理
- 字段引用混乱，维护困难

### 解决方案
1. **枚举提取**: 将枚举移到独立文件
2. **配置类统一**: 创建配置类管理所有配置
3. **字段引用更新**: 批量更新所有字段引用
4. **向后兼容**: 保留旧API接口

### 重构步骤
1. 创建独立枚举文件
2. 创建配置类
3. 更新管理器类使用配置
4. 批量更新字段引用
5. 提供向后兼容API
6. 验证编译和功能

## 常见重构场景

### 枚举提取
- **适用场景**: 枚举在多个文件中被引用
- **注意事项**: 更新所有引用，确保命名空间正确

### 配置类重构
- **适用场景**: 配置字段分散，难以管理
- **注意事项**: 保持API兼容性，提供迁移路径

### 方法重构
- **适用场景**: 硬编码逻辑，难以扩展
- **注意事项**: 分阶段进行，保持功能完整

## 重构工具

### 编译检查
```bash
Get-ChildItem -Recurse -Filter "*.cs" -Path "Assets" | 
Select-String "CS0103|CS0117|CS0426"
```

### 批量替换
```bash
Get-ChildItem -Recurse -Filter "*.cs" -Path "Assets" | 
ForEach-Object { (Get-Content $_.FullName) -replace "OldPattern", "NewPattern" | Set-Content $_.FullName }
```

### 引用查找
```bash
Get-ChildItem -Recurse -Filter "*.cs" -Path "Assets" | 
Select-String "PatternToFind"
```

## 重构陷阱

### 字段引用遗漏
- **问题**: 重构时遗漏某些字段引用
- **解决**: 使用工具批量查找和替换
- **预防**: 重构前完整分析所有引用

### 命名空间冲突
- **问题**: 枚举提取后出现命名空间冲突
- **解决**: 确保正确的using语句
- **预防**: 使用完整的命名空间路径

### API兼容性破坏
- **问题**: 重构破坏了现有API
- **解决**: 提供兼容性包装方法
- **预防**: 重构前分析API使用情况

## 重构检查清单

### 重构前
- [ ] 分析影响范围和依赖关系
- [ ] 制定详细的重构计划
- [ ] 确保有足够的测试覆盖
- [ ] 备份当前代码状态

### 重构中
- [ ] 分阶段进行，保持编译通过
- [ ] 及时更新所有相关引用
- [ ] 保持API向后兼容
- [ ] 同步更新文档

### 重构后
- [ ] 运行所有测试用例
- [ ] 检查编译错误和警告
- [ ] 验证功能完整性
- [ ] 更新相关文档

## 重要提醒
- **不要教条化**: 根据实际需求选择重构方案
- **充分测试**: 重构后进行全面测试验证
- **团队沟通**: 重构前通知团队，重构后分享经验
- **文档同步**: 重构过程中同步更新相关文档